<div class="contenedor-formulario">
  <h2 class="titulo-pagina">
    <i class="fas fa-user-plus"></i> {{ editing ? 'Editar' : 'Nuevo' }} Usuario
  </h2>

  <form [formGroup]="usuarioForm" (ngSubmit)="guardar()">

    <!-- Nombre -->
    <div class="grupo-formulario">
      <label for="nombre" class="etiqueta-formulario">Nombre *</label>
      <input
        id="nombre"
        type="text"
        class="campo-formulario"
        formControlName="nombre"
        placeholder="Ingresa el nombre"
        [class.campo-invalido]="nombreControl?.invalid && nombreControl?.touched" />

      <div class="mensaje-error"
        *ngIf="nombreControl?.invalid && nombreControl?.touched">
        <small *ngIf="nombreControl?.errors?.['required']">El nombre es
          obligatorio.</small>
        <small *ngIf="nombreControl?.errors?.['minlength']">Debe tener al menos
          3 caracteres.</small>
      </div>
    </div>

    <!-- Email -->
    <div class="grupo-formulario">
      <label for="email" class="etiqueta-formulario">Email *</label>
      <input
        id="email"
        type="email"
        class="campo-formulario"
        formControlName="email"
        placeholder="Ingresa el email"
        [class.campo-invalido]="emailControl?.invalid && emailControl?.touched" />

      <div class="mensaje-error"
        *ngIf="emailControl?.invalid && emailControl?.touched">
        <small *ngIf="emailControl?.errors?.['required']">El email es
          obligatorio.</small>
        <small *ngIf="emailControl?.errors?.['email']">Formato de email
          inválido.</small>
      </div>
    </div>

    <!-- Contraseña (solo en modo crear) -->
    <div class="grupo-formulario" *ngIf="!editing">
      <label for="password" class="etiqueta-formulario">Contraseña *</label>
      <input
        id="password"
        type="password"
        class="campo-formulario"
        formControlName="password"
        placeholder="Ingresa una contraseña"
        [class.campo-invalido]="passwordControl?.invalid && passwordControl?.touched" />

      <div class="mensaje-error"
        *ngIf="passwordControl?.invalid && passwordControl?.touched">
        <small *ngIf="passwordControl?.errors?.['required']">La contraseña es
          obligatoria.</small>
        <small *ngIf="passwordControl?.errors?.['minlength']">Mínimo 6
          caracteres.</small>
      </div>
    </div>

    <!-- Rol -->
    <div class="grupo-formulario">
      <label for="rol" class="etiqueta-formulario">Rol *</label>

      <select
        id="rol"
        class="campo-formulario"
        formControlName="rol"
        [class.campo-invalido]="rolControl?.invalid && rolControl?.touched">

        <option value disabled>Seleccione un rol</option>
        <option value="EMPLEADO">Empleado</option>
      </select>

      <div class="mensaje-error"
        *ngIf="rolControl?.invalid && rolControl?.touched">
        <small *ngIf="rolControl?.errors?.['required']">El rol es
          obligatorio.</small>
      </div>
    </div>

    <!-- Error General -->
    <div *ngIf="errorMessage" class="mensaje-error">
      <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
    </div>

    <!-- Botones -->
    <div class="contenedor-botones-formulario">
      <button
        type="submit"
        class="boton boton-primario"
        [disabled]="isSubmitting || usuarioForm.invalid">

        <i class="fas"
          [class.fa-save]="!isSubmitting"
          [class.fa-spinner]="isSubmitting"
          [class.fa-spin]="isSubmitting">
        </i>

        {{ isSubmitting ? 'Guardando...' : 'Guardar' }}
      </button>

      <button
        type="button"
        class="boton boton-secundario"
        (click)="goToUsuarioList()">
        <i class="fas fa-times"></i> Cancelar
      </button>
    </div>
  </form>
</div>
