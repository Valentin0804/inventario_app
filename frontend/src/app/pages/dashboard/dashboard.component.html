<div class="contenedor-dashboard">

  <!-- Barra de navegación -->
  <nav class="barra-navegacion">
    <h1 class="titulo-dashboard">Panel de Control General</h1>
    <div class="contenedor-botones-navegacion">
      <!-- Corregí las rutas de estos botones -->
      <button class="boton-navegacion">
        <i class="fas fa-home"></i> Inicio
      </button>
      <button class="boton-navegacion" (click)="goToVentas()">
        <i class="fas fa-chart-line"></i> Ventas
      </button>
      <button class="boton-navegacion" (click)="goToAddProduct()">
        <i class="fas fa-boxes"></i> Inventario
      </button>
      <!-- Botón de configuración -->
      <button class="boton-navegacion">
        <i class="fas fa-cog"></i> Configuración
      </button>
    </div>
  </nav>

  <ng-container *ngIf="!loading; else cargando">

    <!-- Sección de acciones principales -->
    <section class="seccion-contenedor">
      <h2 class="titulo-seccion">Acciones Principales</h2>
      <div class="contenedor-acciones">
        <!-- Acción principal destacada -->
        <div class="tarjeta accion-principal">
          <div class="icono-accion-principal">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="contenido-accion-principal">
            <h3>Nueva Venta</h3>
            <p>Registra una nueva transacción de venta en el sistema.</p>
            <button class="boton-principal" (click)="goToAddVenta()">
              Iniciar Venta
            </button>
          </div>
        </div>

        <!-- Acciones secundarias en grid -->
        <div class="contenedor-acciones-secundarias">
          <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-box"></i>
            </div>
            <h3>Cargar Producto</h3>
            <p>Añade un nuevo ítem a tu inventario de productos.</p>
            <button class="boton-secundario" (click)="goToAddProduct()">
              Añadir Producto
            </button>
          </div>

          <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-truck"></i>
            </div>
            <h3>Cargar Proveedor</h3>
            <p>Registra un nuevo contacto de proveedor.</p>
            <button class="boton-secundario" (click)="goToAddProveedor()">
              Añadir Proveedor
            </button>
          </div>

          <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-tags"></i>
            </div>
            <h3>Cargar Categoría</h3>
            <p>Organiza tus productos con nuevas categorías.</p>
            <button class="boton-secundario" (click)="goToAddCategoria()">
              Añadir Categoría
            </button>
          </div>

          <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-credit-card"></i>
            </div>
            <h3>Cargar Método de Pago</h3>
            <p>Agrega un nuevo método de pago para las transacciones.</p>
            <button class="boton-secundario" (click)="goToAddMetodoPago()">
              Añadir Método
            </button>
          </div>

          <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-history"></i>
            </div>
            <h3>Historial de Ventas</h3>
            <p>Consulta el registro completo de todas las ventas realizadas.</p>
            <button class="boton-secundario" (click)="goToVentas()">
              Ver Historial
            </button>
          </div>

           <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-history"></i>
            </div>
            <h3>Sub Cuentas</h3>
            <p>Mira el registro de tus empleados.</p>
            <button class="boton-secundario" (click)="goToUsuarios()">
              Ver Historial
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Sección de KPIs -->
    <section class="seccion-contenedor">
      <h2 class="titulo-seccion">Resumen del Día</h2>
      <div class="contenedor-kpis">
        <div class="tarjeta tarjeta-kpi">
          <div class="icono-kpi">
            <i class="fas fa-chart-bar"></i>
          </div>
          <h3>Ventas Realizadas</h3>
          <!-- Usamos summary directo -->
          <p class="valor-kpi">{{ summary.kpis.salesToday }}</p>
          <span class="unidad-kpi">transacciones</span>
        </div>
        <div class="tarjeta tarjeta-kpi">
          <div class="icono-kpi">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <h3>Ingresos Totales</h3>
          <!-- Usamos summary directo -->
          <p class="valor-kpi">{{ summary.kpis.revenueToday |
            currency:'ARS':'symbol-narrow':'1.0-0' }}</p>
          <span class="unidad-kpi">Pesos Argentinos</span>
        </div>
      </div>
    </section>

    <!-- Tarjeta de Métodos de Pago -->
    <section class="seccion-contenedor"
      *ngIf="summary.charts.salesByMethod.length > 0">
      <h2 class="titulo-seccion">Detalle Financiero</h2>
      <div class="tarjeta">
        <div class="encabezado-alerta">
          <i class="fas fa-wallet icono-alerta" style="color: #4CAF50;"></i>
          <h3>Ventas por Método (Hoy)</h3>
        </div>

        <ul class="lista-alerta">
          <li *ngFor="let metodo of summary.charts.salesByMethod"
            class="item-alerta">
            <div class="info-producto">
              <span class="nombre-producto">{{ metodo.metodoPago.nombre
                }}</span>
            </div>

            <div class="estado-stock">
              <span class="badge-stock">{{ metodo.cantidad }} ventas</span>
            </div>

            <div class="monto-metodo">
              <strong>${{ metodo.total }}</strong>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Alerta Stock -->
    <ul class="lista-alerta">
      <li *ngFor="let product of summary.alerts.lowStockProducts"
        class="item-alerta">

        <!--Info Producto -->
        <div class="info-producto">
          <span class="nombre-producto">{{ product.nombre }}</span>

          <!-- Datos del proveedor -->
          <div class="info-proveedor" *ngIf="product.proveedor">
            <i class="fas fa-truck-loading"></i> {{ product.proveedor.nombre }}
          </div>
          <div class="info-proveedor" *ngIf="!product.proveedor">
            <small class="texto-gris">Sin proveedor asignado</small>
          </div>
        </div>

        <!-- Estado del Stock -->
        <div class="estado-stock">
          <span class="badge-stock">
            Actual: <strong>{{ product.stock }}</strong>
          </span>
          <span class="meta-stock">Mín: {{ product.alarma_stock }}</span>
        </div>


        <div class="acciones-rapidas" *ngIf="product.proveedor">

          <!-- Botón WhatsApp -->
          <a *ngIf="product.proveedor.telefono"
            [href]="'https://wa.me/' + product.proveedor.telefono + '?text=Hola, necesito reponer stock de ' + product.nombre"
            target="_blank"
            class="btn-icon whatsapp"
            title="Pedir por WhatsApp">
            <i class="fab fa-whatsapp"></i>
          </a>

          <!-- Botón Email -->
          <a *ngIf="product.proveedor.email"
            [href]="'mailto:' + product.proveedor.email + '?subject=Reposición de ' + product.nombre"
            class="btn-icon email"
            title="Enviar Correo">
            <i class="fas fa-envelope"></i>
          </a>

        </div>
      </li>
    </ul>

    <!-- El botón principal ahora lleva al inventario filtrado 
    <button class="boton-detalles" [routerLink]="['/productos']"
      [queryParams]="{ alerta: 'stock-bajo' }">
      Gestionar Inventario <i class="fas fa-arrow-right"></i>
    </button> -->

  </ng-container>

  <ng-template #cargando>
    <div class="estado-cargando">
      <i class="fas fa-spinner fa-spin icono-cargando"></i>
      <p>Cargando datos del dashboard...</p>
    </div>
  </ng-template>
</div>