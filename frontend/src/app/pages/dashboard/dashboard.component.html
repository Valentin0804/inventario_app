<div class="contenedor-dashboard">

  <!-- Barra de navegación -->
  <nav class="barra-navegacion">
    <h1 class="titulo-dashboard">Panel de Control General</h1>
    <div class="contenedor-botones-navegacion">

      <button class="boton-navegacion">
        <i class="fas fa-home"></i> Inicio
      </button>

      <!-- Historial de Ventas - visible para ambos -->
      <button class="boton-navegacion" (click)="goToVentas()">
        <i class="fas fa-chart-line"></i> Ventas
      </button>

      <!-- Inventario SOLO para dueño -->
      <button class="boton-navegacion" *ngIf="isDueno"
        (click)="goToAddProduct()">
        <i class="fas fa-boxes"></i> Inventario
      </button>

      <button (click)="logout()" class="boton-navegacion">
        Cerrar sesión
      </button>
    </div>
  </nav>

  <ng-container *ngIf="!loading; else cargando">

    <!-- ACCIONES PRINCIPALES -->
    <section class="seccion-contenedor">
      <h2 class="titulo-seccion">Acciones Principales</h2>

      <div class="contenedor-acciones">

        <!-- NUEVA VENTA (dueño y empleado) -->
        <div class="tarjeta accion-principal">
          <div class="icono-accion-principal">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="contenido-accion-principal">
            <h3>Nueva Venta</h3>
            <p>Registra una nueva transacción de venta en el sistema.</p>
            <button class="boton-principal" (click)="goToAddVenta()">
              Iniciar Venta
            </button>
          </div>
        </div>

        <!-- Acciones secundarias -->
        <div class="contenedor-acciones-secundarias">

          <!-- Cargar Producto (dueño y empleado) -->
          <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-box"></i>
            </div>
            <h3>Cargar Producto</h3>
            <p>Añade un nuevo ítem a tu inventario.</p>
            <button class="boton-secundario" (click)="goToAddProduct()">
              Añadir Producto
            </button>
          </div>

          <!-- Cargar Proveedor - SOLO dueño -->
          <div class="tarjeta accion-secundaria" *ngIf="isDueno">
            <div class="icono-accion-secundaria">
              <i class="fas fa-truck"></i>
            </div>
            <h3>Cargar Proveedor</h3>
            <p>Registra un nuevo proveedor.</p>
            <button class="boton-secundario" (click)="goToAddProveedor()">
              Añadir Proveedor
            </button>
          </div>

          <!-- Categoría - SOLO dueño -->
          <div class="tarjeta accion-secundaria" *ngIf="isDueno">
            <div class="icono-accion-secundaria">
              <i class="fas fa-tags"></i>
            </div>
            <h3>Cargar Categoría</h3>
            <p>Organiza tus productos.</p>
            <button class="boton-secundario" (click)="goToAddCategoria()">
              Añadir Categoría
            </button>
          </div>

          <!-- Método de Pago - SOLO dueño -->
          <div class="tarjeta accion-secundaria" *ngIf="isDueno">
            <div class="icono-accion-secundaria">
              <i class="fas fa-credit-card"></i>
            </div>
            <h3>Cargar Método de Pago</h3>
            <p>Agrega un método de pago.</p>
            <button class="boton-secundario" (click)="goToAddMetodoPago()">
              Añadir Método
            </button>
          </div>

          <!-- Historial de Ventas - ambos -->
          <div class="tarjeta accion-secundaria">
            <div class="icono-accion-secundaria">
              <i class="fas fa-history"></i>
            </div>
            <h3>Historial de Ventas</h3>
            <p>Consulta el registro de ventas.</p>
            <button class="boton-secundario" (click)="goToVentas()">
              Ver Historial
            </button>
          </div>

          <!-- Subcuentas SOLO dueño -->
          <div class="tarjeta accion-secundaria" *ngIf="isDueno">
            <div class="icono-accion-secundaria">
              <i class="fas fa-users"></i>
            </div>
            <h3>Sub Cuentas</h3>
            <p>Gestiona empleados.</p>
            <button class="boton-secundario" (click)="goToUsuarios()">
              Ver Usuarios
            </button>
          </div>

        </div>
      </div>
    </section>

    <!-- KPIs (Cambian por rol) -->
    <section class="seccion-contenedor">
      <h2 class="titulo-seccion">Resumen del Día</h2>

      <div class="contenedor-kpis">
        <div class="tarjeta tarjeta-kpi">
          <div class="icono-kpi">
            <i class="fas fa-chart-bar"></i>
          </div>
          <h3>Ventas Realizadas</h3>

          <!-- Dueño ve ventas globales -->
          <p class="valor-kpi" *ngIf="isDueno">
            {{ summary.kpis.salesToday }}
          </p>

          <!-- Empleado ve solo sus ventas -->
          <p class="valor-kpi" *ngIf="isEmpleado">
            {{ summary.kpis.salesToday }}
          </p>

          <span class="unidad-kpi">transacciones</span>
        </div>

        <div class="tarjeta tarjeta-kpi">
          <div class="icono-kpi">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <h3>Ingresos Totales</h3>

          <!-- zz -->
          <p class="valor-kpi" *ngIf="isDueno">
            {{ summary.kpis.revenueToday |
            currency:'ARS':'symbol-narrow':'1.0-0' }}
          </p>

          <!-- Empleado -->
          <p class="valor-kpi" *ngIf="isEmpleado">
            {{ summary.kpis.revenueToday |
            currency:'ARS':'symbol-narrow':'1.0-0' }}
          </p>

          <span class="unidad-kpi">Pesos Argentinos</span>
        </div>
      </div>
    </section>

    <!-- MÉTODOS DE PAGO: Ambos roles -->
    <section class="seccion-contenedor"
      *ngIf="summary.charts.salesByMethod.length > 0">
      <h2 class="titulo-seccion">Detalle Financiero</h2>

      <div class="tarjeta">
        <div class="encabezado-alerta">
          <i class="fas fa-wallet icono-alerta" style="color: #4CAF50;"></i>
          <h3>Ventas por Método (Hoy)</h3>
        </div>

        <ul class="lista-alerta">
          <li *ngFor="let metodo of summary.charts.salesByMethod"
            class="item-alerta">
            <div class="info-producto">
              <span class="nombre-producto">{{ metodo.metodoPago.nombre
                }}</span>
            </div>
            <div class="estado-stock">
              <span class="badge-stock">{{ metodo.cantidad }} ventas</span>
            </div>
            <div class="monto-metodo">
              <strong>${{ metodo.total }}</strong>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- ALERTAS STOCK: Ambos roles -->
    <ul class="lista-alerta">
      <li *ngFor="let product of summary.alerts.lowStockProducts"
        class="item-alerta">

        <div class="info-producto">
          <span class="nombre-producto">{{ product.nombre }}</span>

          <div class="info-proveedor" *ngIf="product.proveedor">
            <i class="fas fa-truck-loading"></i> {{ product.proveedor.nombre }}
          </div>
          <div class="info-proveedor" *ngIf="!product.proveedor">
            <small class="texto-gris">Sin proveedor asignado</small>
          </div>
        </div>

        <div class="estado-stock">
          <span class="badge-stock">
            Actual: <strong>{{ product.stock }}</strong>
          </span>
          <span class="meta-stock">Mín: {{ product.alarma_stock }}</span>
        </div>

        <div class="acciones-rapidas" *ngIf="product.proveedor">

          <a *ngIf="product.proveedor.telefono"
            [href]="'https://wa.me/' + product.proveedor.telefono + '?text=Hola, necesito reponer stock de ' + product.nombre"
            target="_blank"
            class="btn-icon whatsapp">
            <i class="fab fa-whatsapp"></i>
          </a>

          <a *ngIf="product.proveedor.email"
            [href]="'mailto:' + product.proveedor.email + '?subject=Reposición de ' + product.nombre"
            class="btn-icon email">
            <i class="fas fa-envelope"></i>
          </a>

        </div>
      </li>
    </ul>

  </ng-container>

  <ng-template #cargando>
    <div class="estado-cargando">
      <i class="fas fa-spinner fa-spin icono-cargando"></i>
      <p>Cargando datos del dashboard...</p>
    </div>
  </ng-template>

</div>
